apply plugin: 'com.android.application'

allprojects {
    repositories {
        jcenter()
        maven { url "https://maven.google.com" }
        maven { url "https://dl.bintray.com/blockchainds/bds" }
    }
}
android {
    defaultConfig {
        applicationId 'net.anei.cadpage'
        versionName project.versionName
        versionCode project.versionCode
        targetSdkVersion 29
        minSdkVersion 16
        multiDexEnabled true
    }
    dexOptions {
        jumboMode = true
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt')
        }

        flavorDimensions "store", "type"
        productFlavors {

            google {
                dimension "store"
                versionNameSuffix "G"
                versionCode 0
                buildConfigField "boolean", "APTOIDE", "false"
            }

            aptoide {
                dimension "store"
                versionNameSuffix "A"
                versionCode 1
                buildConfigField "boolean", "APTOIDE", "true"
            }

            full {
                dimension "type"
                versionNameSuffix "M"
                versionCode 1
                buildConfigField "boolean", "MSG_ALLOWED", "true"
            }

            restrict {
                dimension "type"
                versionNameSuffix "R"
                versionCode 0
                buildConfigField "boolean", "MSG_ALLOWED", "false"
            }
        }
    }

    applicationVariants.all { variant ->
        def storeVersion = variant.productFlavors.get(0).versionCode
        def typeVersion = variant.productFlavors.get(1).versionCode
        def version = storeVersion * 1000000000 + defaultConfig.versionCode + typeVersion
        variant.outputs.each { output ->
            output.versionCodeOverride = version
        }
    }

    variantFilter { variant ->
        def names = variant.flavors*.name
        if (names.contains("aptoide") && !names.contains("full")) {
            setIgnore(true)
        }
    }

    compileSdkVersion 29

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    buildToolsVersion '28.0.3'
}

dependencies {
    implementation project(':cadpage-parsers')
    implementation 'androidx.multidex:multidex:2.0.1'
    implementation 'androidx.appcompat:appcompat:1.1.0'
    implementation 'androidx.legacy:legacy-support-v4:1.0.0'
    implementation 'androidx.preference:preference:1.1.0'
    implementation 'androidx.recyclerview:recyclerview:1.1.0'
    implementation 'com.google.firebase:firebase-core:17.2.1'
    implementation 'com.google.firebase:firebase-iid:20.0.2'
    implementation 'com.google.firebase:firebase-messaging:20.1.0'
    implementation 'androidx.work:work-runtime:2.2.0'
    implementation 'androidx.lifecycle:lifecycle-common-java8:2.1.0'
    implementation 'androidx.lifecycle:lifecycle-extensions:2.1.0'
    googleImplementation 'com.android.billingclient:billing:2.1.0'
    aptoideImplementation 'com.blockchainds:appcoins-ads:0.5.1.32b'
    aptoideImplementation 'com.blockchainds:android-appcoins-billing:0.5.1.32b'
    aptoideImplementation 'com.blockchainds:appcoins-contract-proxy:0.5.1.32b'
}

apply plugin: 'com.google.gms.google-services'
